#docker build -t dispenser-api -f .\wrapped-back-dockerfile .
#docker run -dp 8080:8080 -e spring.data.mongodb.host=localhost --name dispenser-api dispenser-api

FROM alpine/git:latest AS cloner
RUN git clone https://github.com/theogiraudet/Dispenser-API.git
#ENTRYPOINT ["tail", "-f", "/dev/null"]

FROM maven:3.8.4-openjdk-17-slim AS builder
COPY --from=cloner /git/Dispenser-API/src/ src/
COPY --from=cloner /git/Dispenser-API/.mvn/ .mvn/
COPY --from=cloner /git/Dispenser-API/pom.xml .
COPY --from=cloner /git/Dispenser-API/mvnw .
COPY --from=cloner /git/Dispenser-API/mvnw.cmd .
RUN mvn -quiet package

FROM openjdk:17.0.1
COPY --from=builder target/*.jar app.jar
COPY --from=cloner /git/Dispenser-API/deploy/config.properties config.properties

EXPOSE 8080
ENTRYPOINT ["java","-jar","app.jar"]